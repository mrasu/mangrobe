syntax = "proto3";

package mangroove.api;
import "google/protobuf/timestamp.proto";

service DataManipulationService {
  rpc GetLatestSnapshot(GetLatestSnapshotRequest) returns (GetLatestSnapshotResponse) {};
  rpc ChangeFiles(ChangeFilesRequest) returns (ChangeFilesResponse);
}

message GetLatestSnapshotRequest {}

message GetLatestSnapshotResponse {
  Snapshot snapshot = 1;
}

message Snapshot {
  repeated File files = 1;
}

message File {
  string path = 1;
  int64 size = 2;
}

message ChangeFilesRequest {
  // Must be shorter than 16 byte
  bytes idempotency_key = 1;
  int64 tenant_id = 2;
  google.protobuf.Timestamp partition_time = 3;

  repeated FileAddEntry file_add_entries = 4;
}

message FileAddEntry {
  string path = 1;
  int64 size = 2;
}

message ChangeFilesResponse {
  int64 ChangeLogId = 1;
}
